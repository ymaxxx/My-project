<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>多項式関数の積分</title>
</head>
<body>
  <p>被積分関数の係数リストを入力してください</p>
  <p>例1：1,0 👉 \(x^3\)</p>
  <p>例2：1,2,3,4 👉 \(x^3 + 2x^2 + 3x + 4\)</p>
  <p>例3：-1,0,0,1/3,0 👉 \(-x^4 + (1/3)x\)</p>
  <input type="text" id="coefficients" value="1,2,3,4"><br>

  <p>積分区間を入力してください</p>
  開始：<input type="number" id="start" value="-1">
  終了：<input type="number" id="end" value="1"><br><br>

  <p>積分区間の分割数を入力してください</p>
  <input type="number" id="subdivisions" value="100"><br>

  <button onclick="calculate()">送信</button>

  <p id="output">入力された関数と積分結果がここに表示されます。</p>

  <script>
    function calculate() {
      const coeffs = document.getElementById("coefficients").value.split(',').map(Number);
      const a = Number(document.getElementById("start").value);
      const b = Number(document.getElementById("end").value);
      const n = Number(document.getElementById("subdivisions").value);

      // 多項式関数の評価
      //array.reduce((累積値, 現在の値, インデックス) => 処理, 初期値)
      function poly(x) {
        return coeffs.reduce((acc, c, i) => acc + c * Math.pow(x, coeffs.length - i - 1), 0);
      }

      const dx = (b - a) / n;
      let riemannSum = 0;
      for (let i = 1; i <= n; i++) {
        riemannSum += poly(a + i * dx);
      }
      riemannSum *= dx;

    // 原始関数を使って真の積分値を計算
    //array.reduce((累積値, 現在の値, インデックス) => 処理, 初期値)を理解し、これを利用して原始関数の評価をする
    function antiderivative(x) {
    return coeffs.reduce((acc, c, i) => {
        const power = coeffs.length - i;
        return acc + c / power * Math.pow(x, power);
    }, 0);
    }

    const trueIntegral = antiderivative(b) - antiderivative(a);
      const output = document.getElementById("output");
      //出力THMLを作成、toFixedを利用して小数点以下ｎ桁を表示する
      output.innerHTML = `
        入力された関数 ${coeffs.map((c, i) => `${c}x^${coeffs.length - i - 1}`).join(' + ')} に対し、<br>
        区間 [${a}, ${b}] における分割数 ${n} のリーマン和（右和）は ${riemannSum.toFixed(10)}<br>
        真の積分値は ${trueIntegral.toFixed(10)}.
      `;
    }
  </script>
</body>
</html>
